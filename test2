import pygame
import random
import sys

# 1. INITIALISATIE & CONSTANTEN
pygame.init()

BLACK = (0, 0, 0)
RED = (255, 0, 0)
WHITE = (255, 255, 255)
BLUE = (0, 100, 255)
GREEN = (0, 255, 0)

SCREEN_SIZE = (1024, 768)
BLOCK_SIZE = 25
BLOCK_COUNT = 15
PLAYER_RADIUS = 20

MOVEMENT_SPEED = 7
START_SPEED = 3
SPEED_INCREASE = 0.002
MAX_SPEED = 12

# Lettertypes
FONT_GAME_OVER = pygame.font.SysFont("Arial", 72, bold=True)
FONT_RETRY = pygame.font.SysFont("Arial", 30)
FONT_SCORE = pygame.font.SysFont("Arial", 30, bold=True)

# 2. FUNCTIES
def create_main_surface(screen_size):
    return pygame.display.set_mode(screen_size)

def create_blocks():
    blocks = []
    for _ in range(BLOCK_COUNT):
        x = random.randint(0, SCREEN_SIZE[0] - BLOCK_SIZE)
        y = random.randint(-SCREEN_SIZE[1], 0)
        blocks.append([x, y])
    return blocks

def update_blocks(blocks, fall_speed):
    for block in blocks:
        block[1] += fall_speed
        if block[1] > SCREEN_SIZE[1]:
            block[1] = random.randint(-150, 0)
            block[0] = random.randint(0, SCREEN_SIZE[0] - BLOCK_SIZE)

def show_game_over(surface, final_score):
    waiting = True
    while waiting:
        surface.fill(BLACK)
        
      
        text_surface = FONT_GAME_OVER.render("GAME OVER", True, RED)
        
        
        score_text = "Jouw Score: " + str(final_score // 10)
        final_score_surface = FONT_RETRY.render(score_text, True, WHITE)
        
        
        retry_surface = FONT_RETRY.render("Druk op SPATIE om opnieuw te starten", True, GREEN)
        
       
        text_rect = text_surface.get_rect(center=(SCREEN_SIZE[0]//2, SCREEN_SIZE[1]//2 - 80))
        final_score_rect = final_score_surface.get_rect(center=(SCREEN_SIZE[0]//2, SCREEN_SIZE[1]//2))
        retry_rect = retry_surface.get_rect(center=(SCREEN_SIZE[0]//2, SCREEN_SIZE[1]//2 + 80))
        
        
        surface.blit(text_surface, text_rect)
        surface.blit(final_score_surface, final_score_rect)
        surface.blit(retry_surface, retry_rect)
        
        pygame.display.flip()
        
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_SPACE:
                    waiting = False

def render_frame(surface, blocks, player_x, player_y, current_score):
    surface.fill(BLACK)
    
   
    for block in blocks:
        pygame.draw.rect(surface, RED, (block[0], block[1], BLOCK_SIZE, BLOCK_SIZE))
    
   
    pygame.draw.circle(surface, BLUE, (int(player_x), int(player_y)), PLAYER_RADIUS)
    
   
    score_display = "Score: " + str(current_score // 10)
    score_surface = FONT_SCORE.render(score_display, True, WHITE)
    surface.blit(score_surface, (SCREEN_SIZE[0] - 180, 20))
    
    pygame.display.flip()


def main():
    surface = create_main_surface(SCREEN_SIZE)
    pygame.display.set_caption("Ontwijk de blokken!")
    clock = pygame.time.Clock()

    
    x = SCREEN_SIZE[0] // 2
    y = SCREEN_SIZE[1] - 100
    x_velocity = 0
    blocks = create_blocks()
    fall_speed = START_SPEED
    score = 0

    running = True
    while running:
        clock.tick(60)

        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_ESCAPE:
                    running = False
                if event.key == pygame.K_d: 
                    x_velocity = MOVEMENT_SPEED
                elif event.key == pygame.K_q: 
                    x_velocity = -MOVEMENT_SPEED
            
            if event.type == pygame.KEYUP:
                if event.key in [pygame.K_d, pygame.K_q]:
                    x_velocity = 0

       
        x += x_velocity
        score += 1
        fall_speed = min(fall_speed + SPEED_INCREASE, MAX_SPEED)
        update_blocks(blocks, fall_speed)

       
        if x < PLAYER_RADIUS: x = PLAYER_RADIUS
        if x > SCREEN_SIZE[0] - PLAYER_RADIUS: x = SCREEN_SIZE[0] - PLAYER_RADIUS

        
        player_rect = pygame.Rect(x - PLAYER_RADIUS, y - PLAYER_RADIUS, PLAYER_RADIUS * 2, PLAYER_RADIUS * 2)
        
        for block in blocks:
            block_rect = pygame.Rect(block[0], block[1], BLOCK_SIZE, BLOCK_SIZE)
            
            if player_rect.colliderect(block_rect):
                show_game_over(surface, score) 
                
                
                x = SCREEN_SIZE[0] // 2
                y = SCREEN_SIZE[1] - 100
                x_velocity = 0
                fall_speed = START_SPEED
                score = 0
                blocks = create_blocks()
                break 

       
        render_frame(surface, blocks, x, y, score)

    pygame.quit()
    sys.exit()

if __name__ == '__main__':
    main()